#!/bin/sh

function help() {
   echo "Syntax: hidrive [options] <push|pull> [dir]"
   echo ""
   echo "options:"
   echo "-h     Print this help"
   echo "-u     Update urgency (low, normal, critical)"
   echo ""
   echo "<push> will rclone-sync 'dir' from local to remote."
   echo "<pull> will rclone-copy 'dir' from remote to local."
   echo "[dir] is the directory to work on. Defaults to current dir."
   echo ""
   echo "config file: ~/.config/hidrive.conf"
}

# urgency=NULL

while getopts ":hu:" option; do
    case $option in
        h) help
           exit;;
        # u) urgency=$OPTARG
        #    shift 2
        #    ;;
        \?) echo "Error: invalid option: $OPTARG"
            exit;;
    esac
done

source $HOME/.config/hidrive.conf

CMD=$1
DIR=$2

if [ -z $DIR ]; then
    DIR=$PWD
fi

REMOTE=$(echo "${DIR/$HOME/$remote_root}")

if [ $CMD == "push" ]; then
    CMD=sync
    FROM=$DIR
    TO=$REMOTE
elif [ $CMD == "pull" ]; then
    CMD=copy
    FROM=$REMOTE
    TO=$DIR
else
    help
    exit 1
fi

echo "$CMD from $FROM to $TO"
rclone $CMD -P --skip-links $FROM $TO
