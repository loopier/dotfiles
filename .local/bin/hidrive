#!/bin/sh

function help() {
   echo "Syntax: hidrive [options] <push|pull> [dir]"
   echo ""
   echo "options:"
   echo "-h     Print this help"
   echo "-a     Update all directories listed in .config/hidrive.conf"
   echo ""
   echo "<push> will rclone-sync 'dir' from local to remote."
   echo "<pull> will rclone-copy 'dir' from remote to local."
   echo "[dir] is the directory to work on. Defaults to current dir."
   echo ""
   echo "config file: ~/.config/hidrive.conf"
}

# urgency=NULL

while getopts ":ha" option; do
    case $option in
        h) help
           exit;;
        a) ALL=true
           shift 2
           ;;
        \?) echo "Error: invalid option: $OPTARG"
            exit;;
    esac
done

source $HOME/.config/hidrive.conf

CMD=$1
DIR=$2

if [ -z $DIR ]; then
    DIR=$all
fi

LOCAL=$DIR
# REMOTE=$(echo "${DIR/$HOME/$remote_root}")
REMOTE=$(echo "${DIR/$HOME/}")
REMOTE=$hidrive_remote_root/$DIR

if [ $ALL ]; then
    echo "TODO: update all"
fi

if [ $CMD == "push" ]; then
    CMD=sync
    FROM=$LOCAL
    TO=$REMOTE
elif [ $CMD == "pull" ]; then
    CMD=copy
    FROM=$REMOTE
    TO=$LOCAL
else
    help
    exit 1
fi

if [ $CMD == "sync" ] && [ $FROM == $HOME ]; then
    echo "You tried to push your home folder."
    echo "Please provide a specific path."
    exit 1
fi

echo "$CMD from $FROM to $TO"
rclone $CMD -P --skip-links $FROM $TO
